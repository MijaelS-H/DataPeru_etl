import glob
import pandas as pd
from bamboo_lib.connectors.models import Connector
from bamboo_lib.models import EasyPipeline
from bamboo_lib.models import Parameter
from bamboo_lib.models import PipelineStep
from bamboo_lib.steps import DownloadStep
from bamboo_lib.steps import LoadStep


class TransformStep(PipelineStep):
    def run_step(self, prev, params):

        # Selected columns from dataset for available years
        batch_2018 = ['ubigeo', 'dominio', 'estrato', 'codinfor', 'p300a', 'p301a',
                    'p301b', 'p301c', 'p301d', 'p301a0', 'p301a1', 'p301b0', 'p301b1',
                    'p301b3', 'p302', 'p302x', 'p302a', 'p302b', 'p311n_1', 'p311n_2',
                    'p311n_3', 'p311n_4', 'p311n_5', 'p311n_6', 'p311n_7', 'p311n_8',
                    'p311a1_1', 'p311a1_2', 'p311a1_3', 'p311a1_4', 'p311a1_5', 'p311a1_6',
                    'p311a1_7', 'p311a2_1', 'p311a2_2', 'p311a2_3', 'p311a2_4', 'p311a2_5',
                    'p311a2_6', 'p311a2_7',  'p311a3_1', 'p311a3_2', 'p311a3_3', 'p311a3_4',
                    'p311a3_5', 'p311a3_6', 'p311a3_7', 'p311a4_1', 'p311a4_2', 'p311a4_3',
                    'p311a4_4', 'p311a4_5', 'p311a4_6', 'p311a4_7', 'p311a5_1',
                    'p311a5_2', 'p311a5_3', 'p311a5_4', 'p311a5_5', 'p311a5_6', 'p311a5_7', 'p311a6_1', 
                    'p311a6_2', 'p311a6_3', 'p311a6_4', 'p311a6_5', 'p311a6_6', 'p311a6_7', 'p311a6_8',         
                    'p311a7_1', 'p311a7_2', 'p311a7_3', 'p311a7_4', 'p311a7_5', 'p311a7_6', 'p311a7_7',
                    'p311b_1', 'p311b_2', 'p311b_3', 'p311b_4', 'p311b_5', 'p311b_6', 'p311b_7',   
                    'p311d_1','p311d2_1','p311d3_1','p311d4_1','p311d5_1','p311d6_1','p311d7_1',
                    'p311d_2','p311d2_2','p311d3_2','p311d4_2','p311d5_2','p311d6_2','p311d7_2',
                    'p311d_3','p311d2_3','p311d3_3','p311d4_3','p311d5_3','p311d6_3','p311d7_3',
                    'p311d_4','p311d2_4','p311d3_4','p311d4_4','p311d5_4','p311d6_4','p311d7_4',
                    'p311d_5','p311d2_5','p311d3_5','p311d4_5','p311d5_5','p311d6_5','p311d7_5',          
                    'p311d_6','p311d2_6','p311d3_6','p311d4_6','p311d5_6','p311d6_6','p311d7_6',
                    'p311d_7','p311d2_7','p311d3_7','p311d4_7','p311d5_7','p311d6_7','p311d7_7',
                    'p311e_1', 'p311e_2', 'p311e_3', 'p311e_4', 'p311e_5', 'p311e_6', 'p311e_7',
                    'p311t1', 'p311t2','p3121',
                    'p3121a1', 'p3121a2', 'p3121a3', 'p3121a4', 'p3121a5', 'p3121a6', 'p3121b', 
                    'p3121c', 'p3121c2', 'p3121c3', 'p3121c4', 'p3121c5', 'p3121c6', 'p3121d', 
                    'p3122', 'p3122a1', 'p3122a2', 'p3122a3', 'p3122a4', 'p3122a5', 'p3122a6', 
                    'p3122b', 'p3122c', 'p3122c2', 'p3122c3', 'p3122c4', 'p3122c5', 'p3122c6',  'p3122d',
                    'p312t1','p312t2', 'p312t22', 'p312t23', 'p312t24', 'p312t25', 'p312t26',
                    'p313', 'p314a', 'p314b_1', 'p314b_2', 'p314b_3', 'p314b_4', 'p314b_5', 'p314b_6', 'p314b_7',
                    'p314b1_1', 'p314b1_2', 'p314b1_3', 'p314b1_4', 'p314b1_5', 'p314b1_6', 'p314b1_7',
                    'p314c', 'p314d', 'p3151', 'p3152', 'p3153', 'p3154', 'p3155', 'p3156',
                    'p315a', 'p315b', 'p315b2', 'p315b3', 'p315b4', 'p315b5', 'p315b6',
                    'p316_1', 'p316_2', 'p316_3', 'p316_4', 'p316_5', 'p316_6', 'p316_7', 'p316_8', 'p316_9', 'p316_10', 'p316_11',
                    'p316a1', 'p316a2', 'p316a3', 'p316a4', 'p316a5', 'p316b',
                    # Datos Deflactados 
                    'd311b_1', 'd311b_2', 'd311b_3', 'd311b_4', 'd311b_5', 'd311b_6', 'd311b_7',
                    'd311d_1', 'd311d2_1', 'd311d3_1', 'd311d4_1', 'd311d5_1', 'd311d6_1', 'd311d7_1',
                    'd311d_2', 'd311d2_2', 'd311d3_2', 'd311d4_2', 'd311d5_2', 'd311d6_2', 'd311d7_2',
                    'd311d_3', 'd311d2_3', 'd311d3_3', 'd311d4_3', 'd311d5_3', 'd311d6_3', 'd311d7_3',
                    'd311d_4', 'd311d2_4', 'd311d3_4', 'd311d4_4', 'd311d5_4', 'd311d6_4', 'd311d7_4',
                    'd311d_5', 'd311d2_5', 'd311d3_5', 'd311d4_5', 'd311d5_5', 'd311d6_5', 'd311d7_5',
                    'd311d_6', 'd311d2_6', 'd311d3_6', 'd311d4_6', 'd311d5_6', 'd311d6_6', 'd311d7_6',
                    'd311d_7', 'd311d2_7', 'd311d3_7', 'd311d4_7', 'd311d5_7', 'd311d6_7', 'd311d7_7',
                    'd3121b', 'd3121c', 'd3121c2', 'd3121c3', 'd3121c4', 'd3121c5', 'd3121c6', 
                    'd3122b', 'd3122c', 'd3122c2', 'd3122c3', 'd3122c4', 'd3122c5', 'd3122c6',
                    'd315a', 'd315b', 'd315b2', 'd315b3', 'd315b4', 'd315b5', 'd315b6', 'factor07',
                    'factora07']

        batch_2017 = ['ubigeo', 'dominio', 'estrato', 'codinfor', 'p300a', 'p301a',
                    'p301b', 'p301c', 'p301d', 'p301a0', 'p301a1', 'p301b0', 'p301b1',
                    'p301b3', 'p302', 'p302x', 'p302a', 'p302b', 'p311n_1', 'p311n_2',
                    'p311n_3', 'p311n_4', 'p311n_5', 'p311n_6', 'p311n_7', 'p311n_8',
                    'p311a1_1', 'p311a1_2', 'p311a1_3', 'p311a1_4', 'p311a1_5', 'p311a1_6',
                    'p311a1_7', 'p311a2_1', 'p311a2_2', 'p311a2_3', 'p311a2_4', 'p311a2_5',
                    'p311a2_6', 'p311a2_7',  'p311a3_1', 'p311a3_2', 'p311a3_3', 'p311a3_4',
                    'p311a3_5', 'p311a3_6', 'p311a3_7', 'p311a4_1', 'p311a4_2', 'p311a4_3',
                    'p311a4_4', 'p311a4_5', 'p311a4_6', 'p311a4_7', 'p311a5_1',
                    'p311a5_2', 'p311a5_3', 'p311a5_4', 'p311a5_5', 'p311a5_6', 'p311a5_7', 'p311a6_1', 
                    'p311a6_2', 'p311a6_3', 'p311a6_4', 'p311a6_5', 'p311a6_6', 'p311a6_7', 'p311a6_8',         
                    'p311a7_1', 'p311a7_2', 'p311a7_3', 'p311a7_4', 'p311a7_5', 'p311a7_6', 'p311a7_7',
                    'p311b_1', 'p311b_2', 'p311b_3', 'p311b_4', 'p311b_5', 'p311b_6', 'p311b_7',   
                    'p311d_1','p311d2_1','p311d3_1','p311d4_1','p311d5_1','p311d6_1','p311d7_1',
                    'p311d_2','p311d2_2','p311d3_2','p311d4_2','p311d5_2','p311d6_2','p311d7_2',
                    'p311d_3','p311d2_3','p311d3_3','p311d4_3','p311d5_3','p311d6_3','p311d7_3',
                    'p311d_4','p311d2_4','p311d3_4','p311d4_4','p311d5_4','p311d6_4','p311d7_4',
                    'p311d_5','p311d2_5','p311d3_5','p311d4_5','p311d5_5','p311d6_5','p311d7_5',          
                    'p311d_6','p311d2_6','p311d3_6','p311d4_6','p311d5_6','p311d6_6','p311d7_6',
                    'p311d_7','p311d2_7','p311d3_7','p311d4_7','p311d5_7','p311d6_7','p311d7_7',
                    'p311e_1', 'p311e_2', 'p311e_3', 'p311e_4', 'p311e_5', 'p311e_6', 'p311e_7',
                    'p311t1', 'p311t2','p3121',
                    'p3121a1', 'p3121a2', 'p3121a3', 'p3121a4', 'p3121a5', 'p3121a6', 'p3121b', 
                    'p3121c', 'p3121c2', 'p3121c3', 'p3121c4', 'p3121c5', 'p3121c6', 'p3121d', 
                    'p3122', 'p3122a1', 'p3122a2', 'p3122a3', 'p3122a4', 'p3122a5', 'p3122a6', 
                    'p3122b', 'p3122c', 'p3122c2', 'p3122c3', 'p3122c4', 'p3122c5', 'p3122c6',  'p3122d',
                    'p312t1','p312t2', 'p312t22', 'p312t23', 'p312t24', 'p312t25', 'p312t26',
                    'p313', 'p314a', 'p314b_1', 'p314b_2', 'p314b_3', 'p314b_4', 'p314b_5', 'p314b_6', 'p314b_7',
                    'p314b1_1', 'p314b1_2', 'p314b1_3', 'p314b1_4', 'p314b1_5', 'p314b1_6', 'p314b1_7',
                    'p314c', 'p314d', 'p3151', 'p3152', 'p3153', 'p3154', 'p3155', 'p3156',
                    'p315a', 'p315b', 'p315b2', 'p315b3', 'p315b4', 'p315b5', 'p315b6',
                    'p316_1', 'p316_2', 'p316_3', 'p316_4', 'p316_5', 'p316_6', 'p316_7', 'p316_8', 'p316_9', 'p316_10', 'p316_11',
                    'p316a1', 'p316a2', 'p316a3', 'p316a4', 'p316a5',
                    # Datos Deflactados 
                    'd311b_1', 'd311b_2', 'd311b_3', 'd311b_4', 'd311b_5', 'd311b_6', 'd311b_7',
                    'd311d_1', 'd311d2_1', 'd311d3_1', 'd311d4_1', 'd311d5_1', 'd311d6_1', 'd311d7_1',
                    'd311d_2', 'd311d2_2', 'd311d3_2', 'd311d4_2', 'd311d5_2', 'd311d6_2', 'd311d7_2',
                    'd311d_3', 'd311d2_3', 'd311d3_3', 'd311d4_3', 'd311d5_3', 'd311d6_3', 'd311d7_3',
                    'd311d_4', 'd311d2_4', 'd311d3_4', 'd311d4_4', 'd311d5_4', 'd311d6_4', 'd311d7_4',
                    'd311d_5', 'd311d2_5', 'd311d3_5', 'd311d4_5', 'd311d5_5', 'd311d6_5', 'd311d7_5',
                    'd311d_6', 'd311d2_6', 'd311d3_6', 'd311d4_6', 'd311d5_6', 'd311d6_6', 'd311d7_6',
                    'd311d_7', 'd311d2_7', 'd311d3_7', 'd311d4_7', 'd311d5_7', 'd311d6_7', 'd311d7_7',
                    'd3121b', 'd3121c', 'd3121c2', 'd3121c3', 'd3121c4', 'd3121c5', 'd3121c6', 
                    'd3122b', 'd3122c', 'd3122c2', 'd3122c3', 'd3122c4', 'd3122c5', 'd3122c6',
                    'd315a', 'd315b', 'd315b2', 'd315b3', 'd315b4', 'd315b5', 'd315b6', 'factor07',
                    'factora07']

        batch_2016 = ['ubigeo', 'dominio', 'estrato', 'codinfor', 'p300a', 'p301a',
                    'p301b', 'p301c', 'p301d', 'p301a0', 'p301a1', 'p301b0', 'p301b1',
                    'p301b3', 'p302', 'p302x', 'p302a', 'p302b', 'p311n_1', 'p311n_2',
                    'p311n_3', 'p311n_4', 'p311n_5', 'p311n_6', 'p311n_7', 'p311n_8',
                    'p311a1_1', 'p311a1_2', 'p311a1_3', 'p311a1_4', 'p311a1_5', 'p311a1_6',
                    'p311a1_7', 'p311a2_1', 'p311a2_2', 'p311a2_3', 'p311a2_4', 'p311a2_5',
                    'p311a2_6', 'p311a2_7',  'p311a3_1', 'p311a3_2', 'p311a3_3', 'p311a3_4',
                    'p311a3_5', 'p311a3_6', 'p311a3_7', 'p311a4_1', 'p311a4_2', 'p311a4_3',
                    'p311a4_4', 'p311a4_5', 'p311a4_6', 'p311a4_7', 'p311a5_1',
                    'p311a5_2', 'p311a5_3', 'p311a5_4', 'p311a5_5', 'p311a5_6', 'p311a5_7', 'p311a6_1', 
                    'p311a6_2', 'p311a6_3', 'p311a6_4', 'p311a6_5', 'p311a6_6', 'p311a6_7', 'p311a6_8',         
                    'p311a7_1', 'p311a7_2', 'p311a7_3', 'p311a7_4', 'p311a7_5', 'p311a7_6', 'p311a7_7',
                    'p311b_1', 'p311b_2', 'p311b_3', 'p311b_4', 'p311b_5', 'p311b_6', 'p311b_7',   
                    'p311d_1','p311d2_1','p311d3_1','p311d4_1','p311d5_1','p311d6_1','p311d7_1',
                    'p311d_2','p311d2_2','p311d3_2','p311d4_2','p311d5_2','p311d6_2','p311d7_2',
                    'p311d_3','p311d2_3','p311d3_3','p311d4_3','p311d5_3','p311d6_3','p311d7_3',
                    'p311d_4','p311d2_4','p311d3_4','p311d4_4','p311d5_4','p311d6_4','p311d7_4',
                    'p311d_5','p311d2_5','p311d3_5','p311d4_5','p311d5_5','p311d6_5','p311d7_5',          
                    'p311d_6','p311d2_6','p311d3_6','p311d4_6','p311d5_6','p311d6_6','p311d7_6',
                    'p311d_7','p311d2_7','p311d3_7','p311d4_7','p311d5_7','p311d6_7','p311d7_7',
                    'p311e_1', 'p311e_2', 'p311e_3', 'p311e_4', 'p311e_5', 'p311e_6', 'p311e_7',
                    'p311t1', 'p311t2','p3121',
                    'p3121a1', 'p3121a2', 'p3121a3', 'p3121a4', 'p3121a5', 'p3121a6', 'p3121b', 
                    'p3121c', 'p3121c2', 'p3121c3', 'p3121c4', 'p3121c5', 'p3121c6', 'p3121d', 
                    'p3122', 'p3122a1', 'p3122a2', 'p3122a3', 'p3122a4', 'p3122a5', 'p3122a6', 
                    'p3122b', 'p3122c', 'p3122c2', 'p3122c3', 'p3122c4', 'p3122c5', 'p3122c6',  'p3122d',
                    'p312t1','p312t2', 'p312t22', 'p312t23', 'p312t24', 'p312t25', 'p312t26',
                    'p313', 'p314a', 'p314b_1', 'p314b_2', 'p314b_3', 'p314b_4', 'p314b_5', 'p314b_6', 'p314b_7',
                    'p314b1_1', 'p314b1_2', 'p314b1_3', 'p314b1_4', 'p314b1_5', 'p314b1_6', 'p314b1_7',
                    'p314c', 'p314d', 'p3151', 'p3152', 'p3153', 'p3154', 'p3155', 'p3156',
                    'p315a', 'p315b', 'p315b2', 'p315b3', 'p315b4', 'p315b5', 'p315b6',
                    'p316_1', 'p316_2', 'p316_3', 'p316_4', 'p316_5', 'p316_6', 'p316_7', 'p316_8', 'p316_9', 'p316_10', 'p316_11',
                    # Datos Deflactados 
                    'd311b_1', 'd311b_2', 'd311b_3', 'd311b_4', 'd311b_5', 'd311b_6', 'd311b_7',
                    'd311d_1', 'd311d2_1', 'd311d3_1', 'd311d4_1', 'd311d5_1', 'd311d6_1', 'd311d7_1',
                    'd311d_2', 'd311d2_2', 'd311d3_2', 'd311d4_2', 'd311d5_2', 'd311d6_2', 'd311d7_2',
                    'd311d_3', 'd311d2_3', 'd311d3_3', 'd311d4_3', 'd311d5_3', 'd311d6_3', 'd311d7_3',
                    'd311d_4', 'd311d2_4', 'd311d3_4', 'd311d4_4', 'd311d5_4', 'd311d6_4', 'd311d7_4',
                    'd311d_5', 'd311d2_5', 'd311d3_5', 'd311d4_5', 'd311d5_5', 'd311d6_5', 'd311d7_5',
                    'd311d_6', 'd311d2_6', 'd311d3_6', 'd311d4_6', 'd311d5_6', 'd311d6_6', 'd311d7_6',
                    'd311d_7', 'd311d2_7', 'd311d3_7', 'd311d4_7', 'd311d5_7', 'd311d6_7', 'd311d7_7',
                    'd3121b', 'd3121c', 'd3121c2', 'd3121c3', 'd3121c4', 'd3121c5', 'd3121c6', 
                    'd3122b', 'd3122c', 'd3122c2', 'd3122c3', 'd3122c4', 'd3122c5', 'd3122c6',
                    'd315a', 'd315b', 'd315b2', 'd315b3', 'd315b4', 'd315b5', 'd315b6', 'factor07',
                    'factora07']

        batch_2015 = ['ubigeo', 'dominio', 'estrato', 'codinfor', 'p300a', 'p301a',
                    'p301b', 'p301c', 'p301d', 'p301a0', 'p301a1', 'p301b0', 'p301b1',
                    'p302', 'p302x', 'p302a', 'p302b', 'p311n_1', 'p311n_2',
                    'p311n_3', 'p311n_4', 'p311n_5', 'p311n_6', 'p311n_7', 'p311n_8',
                    'p311a1_1', 'p311a1_2', 'p311a1_3', 'p311a1_4', 'p311a1_5', 'p311a1_6',
                    'p311a1_7', 'p311a2_1', 'p311a2_2', 'p311a2_3', 'p311a2_4', 'p311a2_5',
                    'p311a2_6', 'p311a2_7',  'p311a3_1', 'p311a3_2', 'p311a3_3', 'p311a3_4',
                    'p311a3_5', 'p311a3_6', 'p311a3_7', 'p311a4_1', 'p311a4_2', 'p311a4_3',
                    'p311a4_4', 'p311a4_5', 'p311a4_6', 'p311a4_7', 'p311a5_1',
                    'p311a5_2', 'p311a5_3', 'p311a5_4', 'p311a5_5', 'p311a5_6', 'p311a5_7', 'p311a6_1', 
                    'p311a6_2', 'p311a6_3', 'p311a6_4', 'p311a6_5', 'p311a6_6', 'p311a6_7', 'p311a6_8',         
                    'p311a7_1', 'p311a7_2', 'p311a7_3', 'p311a7_4', 'p311a7_5', 'p311a7_6', 'p311a7_7',
                    'p311b_1', 'p311b_2', 'p311b_3', 'p311b_4', 'p311b_5', 'p311b_6',    
                    'p311d_1',
                    'p311d_2',  
                    'p311d_3',          
                    'p311d_4', 
                    'p311d_5',                    
                    'p311d_6', 'p311d_7',  
                    'p311e_1', 'p311e_2', 'p311e_3', 'p311e_4', 'p311e_5', 'p311e_6', 'p311e_7',
                    'p311t1', 'p311t2','p3121',
                    'p3121a1', 'p3121a2', 'p3121a3', 'p3121a4', 'p3121a5', 'p3121a6', 'p3121b', 
                    'p3121c', 'p3121d', 
                    'p3122', 'p3122a1', 'p3122a2', 'p3122a3', 'p3122a4', 'p3122a5', 'p3122a6', 
                    'p3122b', 'p3122c', 'p3122d',
                    'p312t1','p312t2', 
                    'p313', 'p314a', 'p314b_1', 'p314b_2', 'p314b_3', 'p314b_4', 'p314b_5', 'p314b_6',
                    'p314c', 'p314d', 'p3151', 'p3152', 'p3153', 'p3154', 'p3155', 'p3156',
                    'p315a',
                    'p316_1', 'p316_2', 'p316_3', 'p316_4', 'p316_5', 'p316_6', 'p316_7', 'p316_8', 'p316_9', 'p316_10', 'p316_11',
                    # Datos Deflactados 
                    'd311b_1', 'd311b_2', 'd311b_3', 'd311b_4', 'd311b_5', 'd311b_6', 'd311b_7',
                    'd311d_1', 'factor07', 'factora07']

        batch_2014 = ['ubigeo', 'dominio', 'estrato', 'codinfor', 'p300a', 'p301a',
                    'p301b', 'p301c', 'p301d', 'p301a0', 'p301a1', 'p301b0', 'p301b1',
                    'p302', 'p302x', 'p302a', 'p302b', 'p311n_1', 'p311n_2',
                    'p311n_3', 'p311n_4', 'p311n_5', 'p311n_6', 'p311n_7', 'p311n_8',
                    'p311a1_1', 'p311a1_2', 'p311a1_3', 'p311a1_4', 'p311a1_5', 'p311a1_6',
                    'p311a1_7', 'p311a2_1', 'p311a2_2', 'p311a2_3', 'p311a2_4', 'p311a2_5',
                    'p311a2_6', 'p311a2_7',  'p311a3_1', 'p311a3_2', 'p311a3_3', 'p311a3_4',
                    'p311a3_5', 'p311a3_6', 'p311a3_7', 'p311a4_1', 'p311a4_2', 'p311a4_3',
                    'p311a4_4', 'p311a4_5', 'p311a4_6', 'p311a4_7', 'p311a5_1',
                    'p311a5_2', 'p311a5_3', 'p311a5_4', 'p311a5_5', 'p311a5_6', 'p311a5_7', 'p311a6_1', 
                    'p311a6_2', 'p311a6_3', 'p311a6_4', 'p311a6_5', 'p311a6_6', 'p311a6_7', 'p311a6_8',         
                    'p311a7_1', 'p311a7_2', 'p311a7_3', 'p311a7_4', 'p311a7_5', 'p311a7_6', 'p311a7_7',
                    'p311b_1', 'p311b_2', 'p311b_3', 'p311b_4', 'p311b_5', 'p311b_6',    
                    'p311d_1',
                    'p311d_2',  
                    'p311d_3',          
                    'p311d_4', 
                    'p311d_5',                    
                    'p311d_6', 'p311d_7',  
                    'p311e_1', 'p311e_2', 'p311e_3', 'p311e_4', 'p311e_5', 'p311e_6', 'p311e_7',
                    'p311t1', 'p311t2','p3121',
                    'p3121a1', 'p3121a2', 'p3121a3', 'p3121a4', 'p3121a5', 'p3121a6', 'p3121b', 
                    'p3121c', 'p3121d', 
                    'p3122', 'p3122a1', 'p3122a2', 'p3122a3', 'p3122a4', 'p3122a5', 'p3122a6', 
                    'p3122b', 'p3122c',            'p3122d',
                    'p312t1','p312t2', 
                    'p313', 'p314a', 'p314b_1', 'p314b_2', 'p314b_3', 'p314b_4', 'p314b_5',
                    'p314c', 'p314d', 'p3151', 'p3152', 'p3153', 'p3154', 'p3155', 'p3156',
                    'p315a',
                    'p316_1', 'p316_2', 'p316_3', 'p316_4', 'p316_5', 'p316_6', 'p316_7',
                    # Datos Deflactados 
                    'd311b_1', 'd311b_2', 'd311b_3', 'd311b_4', 'd311b_5', 'd311b_6', 'd311b_7',
                    'd311d_1', 'factor07', 'factora07']

        # Loading dataframe stata step
        try: 
            df = pd.read_stata(params.get('url'), columns = batch_2018)
        except:
            try:
                df = pd.read_stata(params.get('url'), columns = batch_2017)
            except: 
                try:
                    df = pd.read_stata(params.get('url'), columns = batch_2016)
                except: 
                    try:
                        df = pd.read_stata(params.get('url'), columns = batch_2015)
                    except: 
                        df = pd.read_stata(params.get('url'), columns = batch_2014)

        # Excel spreadsheet for renaming columns
        df_labels = "https://docs.google.com/spreadsheets/d/e/2PACX-1vTATtANn3dUv0nucHaGqKXl_hpMjnAHhVHXweIki65R2zS4z00IWOaasm0ZjBCZNwXT2C8ADUhOuyCr/pub?output=xlsx"
        # Getting values of year for the survey
        df["year"] = int(params.get('year'))

        # Adding missing columns between years dataset
        missing_col = [
                    'ubigeo', 'dominio', 'estrato', 'codinfor', 'p300a', 'p301a',
                    'p301b', 'p301c', 'p301d', 'p301a0', 'p301a1', 'p301b0', 'p301b1',
                    'p301b3', 'p302', 'p302x', 'p302a', 'p302b', 'p311n_1', 'p311n_2',
                    'p311n_3', 'p311n_4', 'p311n_5', 'p311n_6', 'p311n_7', 'p311n_8',
                    'p311a1_1', 'p311a1_2', 'p311a1_3', 'p311a1_4', 'p311a1_5', 'p311a1_6',
                    'p311a1_7', 'p311a2_1', 'p311a2_2', 'p311a2_3', 'p311a2_4', 'p311a2_5',
                    'p311a2_6', 'p311a2_7',  'p311a3_1', 'p311a3_2', 'p311a3_3', 'p311a3_4',
                    'p311a3_5', 'p311a3_6', 'p311a3_7', 'p311a4_1', 'p311a4_2', 'p311a4_3',
                    'p311a4_4', 'p311a4_5', 'p311a4_6', 'p311a4_7', 'p311a5_1',
                    'p311a5_2', 'p311a5_3', 'p311a5_4', 'p311a5_5', 'p311a5_6', 'p311a5_7', 'p311a6_1', 
                    'p311a6_2', 'p311a6_3', 'p311a6_4', 'p311a6_5', 'p311a6_6', 'p311a6_7', 'p311a6_8',         
                    'p311a7_1', 'p311a7_2', 'p311a7_3', 'p311a7_4', 'p311a7_5', 'p311a7_6', 'p311a7_7',
                    'p311b_1', 'p311b_2', 'p311b_3', 'p311b_4', 'p311b_5', 'p311b_6', 'p311b_7',   
                    'p311d_1','p311d2_1','p311d3_1','p311d4_1','p311d5_1','p311d6_1','p311d7_1',
                    'p311d_2','p311d2_2','p311d3_2','p311d4_2','p311d5_2','p311d6_2','p311d7_2',
                    'p311d_3','p311d2_3','p311d3_3','p311d4_3','p311d5_3','p311d6_3','p311d7_3',
                    'p311d_4','p311d2_4','p311d3_4','p311d4_4','p311d5_4','p311d6_4','p311d7_4',
                    'p311d_5','p311d2_5','p311d3_5','p311d4_5','p311d5_5','p311d6_5','p311d7_5',          
                    'p311d_6','p311d2_6','p311d3_6','p311d4_6','p311d5_6','p311d6_6','p311d7_6',
                    'p311d_7','p311d2_7','p311d3_7','p311d4_7','p311d5_7','p311d6_7','p311d7_7',
                    'p311e_1', 'p311e_2', 'p311e_3', 'p311e_4', 'p311e_5', 'p311e_6', 'p311e_7',
                    'p311t1', 'p311t2','p3121',
                    'p3121a1', 'p3121a2', 'p3121a3', 'p3121a4', 'p3121a5', 'p3121a6', 'p3121b', 
                    'p3121c', 'p3121c2', 'p3121c3', 'p3121c4', 'p3121c5', 'p3121c6', 'p3121d', 
                    'p3122', 'p3122a1', 'p3122a2', 'p3122a3', 'p3122a4', 'p3122a5', 'p3122a6', 
                    'p3122b', 'p3122c', 'p3122c2', 'p3122c3', 'p3122c4', 'p3122c5', 'p3122c6',  'p3122d',
                    'p312t1','p312t2', 'p312t22', 'p312t23', 'p312t24', 'p312t25', 'p312t26',
                    'p313', 'p314a', 'p314b_1', 'p314b_2', 'p314b_3', 'p314b_4', 'p314b_5', 'p314b_6', 'p314b_7',
                    'p314b1_1', 'p314b1_2', 'p314b1_3', 'p314b1_4', 'p314b1_5', 'p314b1_6', 'p314b1_7',
                    'p314c', 'p314d', 'p3151', 'p3152', 'p3153', 'p3154', 'p3155', 'p3156',
                    'p315a', 'p315b', 'p315b2', 'p315b3', 'p315b4', 'p315b5', 'p315b6',
                    'p316_1', 'p316_2', 'p316_3', 'p316_4', 'p316_5', 'p316_6', 'p316_7', 'p316_8', 'p316_9', 'p316_10', 'p316_11',
                    'p316a1', 'p316a2', 'p316a3', 'p316a4', 'p316a5', 'p316b',
                    # Datos Deflactados 
                    'd311b_1', 'd311b_2', 'd311b_3', 'd311b_4', 'd311b_5', 'd311b_6', 'd311b_7',
                    'd311d_1', 'd311d2_1', 'd311d3_1', 'd311d4_1', 'd311d5_1', 'd311d6_1', 'd311d7_1',
                    'd311d_2', 'd311d2_2', 'd311d3_2', 'd311d4_2', 'd311d5_2', 'd311d6_2', 'd311d7_2',
                    'd311d_3', 'd311d2_3', 'd311d3_3', 'd311d4_3', 'd311d5_3', 'd311d6_3', 'd311d7_3',
                    'd311d_4', 'd311d2_4', 'd311d3_4', 'd311d4_4', 'd311d5_4', 'd311d6_4', 'd311d7_4',
                    'd311d_5', 'd311d2_5', 'd311d3_5', 'd311d4_5', 'd311d5_5', 'd311d6_5', 'd311d7_5',
                    'd311d_6', 'd311d2_6', 'd311d3_6', 'd311d4_6', 'd311d5_6', 'd311d6_6', 'd311d7_6',
                    'd311d_7', 'd311d2_7', 'd311d3_7', 'd311d4_7', 'd311d5_7', 'd311d6_7', 'd311d7_7',
                    'd3121b', 'd3121c', 'd3121c2', 'd3121c3', 'd3121c4', 'd3121c5', 'd3121c6', 
                    'd3122b', 'd3122c', 'd3122c2', 'd3122c3', 'd3122c4', 'd3122c5', 'd3122c6',
                    'd315a', 'd315b', 'd315b2', 'd315b3', 'd315b4', 'd315b5', 'd315b6', 'factor07',
                    'factora07']

        for item in missing_col:
            if item not in df:
                df[item] = pd.np.nan

        # Renaming columns to an understandable name
        df_page = pd.read_excel(df_labels, "columns")
        df = df.rename(columns = dict(zip(df_page.old_name, df_page.new_name)))

        # Excel spreadsheet automatized replace step 
        for i in df.columns:
            try:
                df[i] = df[i].astype(pd.Int8Dtype())
            except:
                pass

        return df

class ENHPipeline(EasyPipeline):
    @staticmethod
    def parameter_list():
        return [
            Parameter(label="Year", name="year", dtype=str),
            Parameter(label="Url", name="url", dtype=str)
        ]

    @staticmethod
    def steps(params):
        db_connector = Connector.fetch("clickhouse-database", open("../conns.yaml"))

        dtype = {
            "ubigeo": "String",
            "dominio": "UInt8",
            "estrato": "UInt8",
            "codinfor": "String",
            "childhood_learned_lenguage": "UInt8",
            "actual_last_academic_degree": "UInt8",
            "last_year_academic_degree": "Float64",
            "last_grade_academic_degree": "Float64",
            "study_facility_academic_degree": "Float64",
            "has_college_career": "Float64",
            "has_college_career_id": "UInt32",
            "has_college_name": "Float64",
            "has_college_id": "UInt32",
            "has_college_faculty_id": "UInt8",
            "qa_reading_writing": "UInt8",
            "test_reading_writing": "UInt8",
            "12m_alphabetization": "UInt8",
            "12m_alphabetization_source": "UInt8",
            "12m_school_uniform": "UInt8",
            "12m_school_shoes": "UInt8",
            "12m_school_text_books": "UInt8",
            "12m_school_school_supplies": "UInt8",
            "12m_school_enrollment": "UInt8",
            "12m_school_APAFA": "UInt8",
            "12m_school_others": "UInt8",
            "12m_school_laptop_by_child_program": "UInt8",
            "bought_uniform": "UInt8",
            "bought_shoes": "UInt8",
            "bought_text_books": "UInt8",
            "bought_school_supplies": "UInt8",
            "bought_enrollment": "UInt8",
            "bought_APAFA": "UInt8",
            "bought_others": "UInt8",
            "self_consumption_uniform": "UInt8",
            "self_consumption_shoes": "UInt8",
            "self_consumption_text_books": "UInt8",
            "self_consumption_school_supplies": "UInt8",
            "self_consumption_enrollment": "UInt8",
            "self_consumption_APAFA": "UInt8",
            "self_consumption_others": "UInt8",
            "self_supply_uniform": "UInt8",
            "self_supply_shoes": "UInt8",
            "self_supply_text_books": "UInt8",
            "self_supply_school_supplies": "UInt8",
            "self_supply_enrollment": "UInt8",
            "self_supply_APAFA": "UInt8",
            "self_supply_others": "UInt8",
            "barter_uniform": "UInt8",
            "barter_shoes": "UInt8",
            "barter_text_books": "UInt8",
            "barter_school_supplies": "UInt8",
            "barter_enrollment": "UInt8",
            "barter_APAFA": "UInt8",
            "barter_others": "UInt8",
            "another_home_uniform": "UInt8",
            "another_home_shoes": "UInt8",
            "another_home_text_books": "UInt8",
            "another_home_school_supplies": "UInt8",
            "another_home_enrollment": "UInt8",
            "another_home_APAFA": "UInt8",
            "another_home_others": "UInt8",
            "social_program_uniform": "UInt8",
            "social_program_shoes": "UInt8",
            "social_program_text_books": "UInt8",
            "social_program_school_supplies": "UInt8",
            "social_program_enrollment": "UInt8",
            "social_program_APAFA": "UInt8",
            "social_program_others": "UInt8",
            "social_program_laptop_by_child_program": "UInt8",
            "other_uniform": "UInt8",
            "other_shoes": "UInt8",
            "other_text_books": "UInt8",
            "other_school_supplies": "UInt8",
            "other_enrollment": "UInt8",
            "other_APAFA": "UInt8",
            "other_others": "UInt8",
            "how_much_cost_uniform": "Float64",
            "how_much_cost_shoes": "Float64",
            "how_much_cost_text_books": "Float64",
            "how_much_cost_school_supplies": "Float64",
            "how_much_cost_enrollment": "Float64",
            "how_much_cost_APAFA": "Float64",
            "how_much_cost_others": "Float64",
            "estimated_cost_bought_uniform": "Float64",
            "estimated_cost_self_consumption_uniform": "Float64",
            "estimated_cost_self_supply_uniform": "Float64",
            "estimated_cost_barter_uniform": "Float64",
            "estimated_cost_another_home_uniform": "Float64",
            "estimated_cost_social_program_uniform": "Float64",
            "estimated_cost_other_uniform": "Float64",
            "estimated_cost_bought_shoes": "Float64",
            "estimated_cost_self_consumption_shoes": "Float64",
            "estimated_cost_self_supply_shoes": "Float64",
            "estimated_cost_barter_shoes": "Float64",
            "estimated_cost_another_home_shoes": "Float64",
            "estimated_cost_social_program_shoes": "Float64",
            "estimated_cost_other_shoes": "Float64",
            "estimated_cost_bought_text_books": "Float64",
            "estimated_cost_self_consumption_text_books": "Float64",
            "estimated_cost_self_supply_text_books": "Float64",
            "estimated_cost_barter_text_books": "Float64",
            "estimated_cost_another_home_text_books": "Float64",
            "estimated_cost_social_program_text_books": "Float64",
            "estimated_cost_other_text_books": "Float64",
            "estimated_cost_bought_school_supplies": "Float64",
            "estimated_cost_self_consumption_school_supplies": "Float64",
            "estimated_cost_self_supply_school_supplies": "Float64",
            "estimated_cost_barter_school_supplies": "Float64",
            "estimated_cost_another_home_school_supplies": "Float64",
            "estimated_cost_social_program_school_supplies": "Float64",
            "estimated_cost_other_school_supplies": "Float64",
            "estimated_cost_bought_enrollment": "Float64",
            "estimated_cost_self_consumption_enrollment": "Float64",
            "estimated_cost_self_supply_enrollment": "Float64",
            "estimated_cost_barter_enrollment": "Float64",
            "estimated_cost_another_home_enrollment": "Float64",
            "estimated_cost_social_program_enrollment": "Float64",
            "estimated_cost_other_enrollment": "Float64",
            "estimated_cost_bought_APAFA": "Float64",
            "estimated_cost_self_consumption_APAFA": "Float64",
            "estimated_cost_self_supply_APAFA": "Float64",
            "estimated_cost_barter_APAFA": "Float64",
            "estimated_cost_another_home_APAFA": "Float64",
            "estimated_cost_social_program_APAFA": "Float64",
            "estimated_cost_other_APAFA": "Float64",
            "estimated_cost_bought_others": "Float64",
            "estimated_cost_self_consumption_others": "Float64",
            "estimated_cost_self_supply_others": "Float64",
            "estimated_cost_barter_others": "Float64",
            "estimated_cost_another_home_others": "Float64",
            "estimated_cost_social_program_others": "Float64",
            "estimated_cost_other_others": "Float64",
            "n_times_uniform": "UInt16",
            "n_times_shoes": "UInt16",
            "n_times_text_books": "UInt16",
            "n_times_school_supplies": "UInt16",
            "n_times_enrollment": "UInt16",
            "n_times_APAFA": "UInt16",
            "n_times_others": "UInt16",
            "total_amount_all_headings_311": "Float64",
            "estimated_total_amount_all_headings_311": "Float64",
            "last_month_spends_mensual_teaching_pension": "UInt8",
            "bought_mensual_teaching_pension": "UInt8",
            "self_supply_mensual_teaching_pension": "UInt8",
            "barter_mensual_teaching_pension": "UInt8",
            "another_home_mensual_teaching_pension": "UInt8",
            "social_program_mensual_teaching_pension": "UInt8",
            "other_mensual_teaching_pension": "UInt8",
            "how_much_cost_mensual_teaching_pension": "Float64",
            "estimated_cost_total_mensual_teaching_pension": "Float64",
            "estimated_cost_self_supply_mensual_teaching_pension": "Float64",
            "estimated_cost_barter_mensual_teaching_pension": "Float64",
            "estimated_cost_another_home_mensual_teaching_pension": "Float64",
            "estimated_cost_social_program_mensual_teaching_pension": "Float64",
            "estimated_cost_other_mensual_teaching_pension": "Float64",
            "n_times_mensual_teaching_pension": "Float64",
            "last_month_spends_particular_transportation": "UInt8",
            "bought_particular_transportation": "UInt8",
            "self_supply_particular_transportation": "UInt8",
            "barter_particular_transportation": "UInt8",
            "another_home_particular_transportation": "UInt8",
            "social_program_particular_transportation": "UInt8",
            "other_particular_transportation": "UInt8",
            "how_much_cost_particular_transportation": "Float64",
            "estimated_cost_total_particular_transportation": "Float64",
            "estimated_cost_self_supply_particular_transportation": "Float64",
            "estimated_cost_barter_particular_transportation": "Float64",
            "estimated_cost_another_home_particular_transportation": "Float64",
            "estimated_cost_social_program_particular_transportation": "Float64",
            "estimated_cost_other_particular_transportation": "Float64",
            "n_times_particular_transportation": "Float64",
            "total_amount_all_headings_312": "Float64",
            "estimated_total_amount_all_headings_312": "Float64",
            "estimated_cost_self_supply_all": "Float64",
            "estimated_cost_barter_all": "Float64",
            "estimated_cost_another_home_all": "Float64",
            "estimated_cost_social_program_all": "Float64",
            "estimated_cost_other_all": "Float64",
            "main_reason_no_actual_studies": "UInt8",
            "last_month_use_UInternet": "UInt8",
            "use_internet_from_home": "UInt8",
            "use_internet_from_work": "UInt8",
            "use_internet_from_education_facility": "UInt8",
            "use_internet_from_public_cabin": "UInt8",
            "use_internet_from_another_home": "UInt8",
            "use_internet_from_other": "UInt8",
            "use_internet_from_mobile_service": "UInt8",
            "use_internet_from_computer": "UInt8",
            "use_internet_from_laptop": "UInt8",
            "use_internet_from_own_cellphone": "UInt8",
            "use_internet_from_friends_cellphone": "UInt8",
            "use_internet_from_works_cellphone": "UInt8",
            "use_internet_from_tablet": "UInt8",
            "use_internet_from_other_device": "UInt8",
            "last_month_internet_highest_used": "UInt8",
            "use_internet_frecuency": "UInt8",
            "bought_internet": "UInt8",
            "self_supply_internet": "UInt8",
            "barter_internet": "UInt8",
            "another_home_internet": "UInt8",
            "social_program_internet": "UInt8",
            "other_internet": "UInt8",
            "how_much_cost_internet": "Float64",
            "estimated_total_amount_internet": "Float64",
            "estimated_cost_self_supply_internet": "Float64",
            "estimated_cost_barter_internet": "Float64",
            "estimated_cost_another_home_internet": "Float64",
            "estimated_cost_social_program_internet": "Float64",
            "estimated_cost_other_internet": "Float64",
            "use_internet_for_information": "UInt8",
            "use_internet_for_comunication": "UInt8",
            "use_internet_for_buying": "UInt8",
            "use_internet_for_financial_transactions": "UInt8",
            "use_internet_for_formal_education": "UInt8",
            "use_internet_for_organizations_transactions": "UInt8",
            "use_internet_for_entertainment": "UInt8",
            "use_internet_for_sells": "UInt8",
            "use_internet_for_other_1": "UInt8",
            "use_internet_for_other_2": "UInt8",
            "use_internet_for_other_3": "UInt8",
            "last_month_use_own_cellphone": "UInt8",
            "last_month_use_someones_cellphone": "UInt8",
            "last_month_use_works_cellphone": "UInt8",
            "last_month_use_own_cellphone_other": "UInt8",
            "last_month_no_use_cellphone": "UInt8",
            "last_3m_use_any_typing_item": "UInt8",
            "deflected_how_much_cost_uniform": "UInt64",
            "deflected_how_much_cost_shoes": "UInt64",
            "deflected_how_much_cost_text_books": "UInt64",
            "deflected_how_much_cost_school_supplies": "UInt64",
            "deflected_how_much_cost_enrollment": "UInt64",
            "deflected_how_much_cost_APAFA": "UInt64",
            "deflected_how_much_cost_others": "UInt64",
            "deflected_total_how_much_cost_uniform": "UInt64",
            "deflected_estimated_cost_self_consumption_uniform": "UInt64",
            "deflected_estimated_cost_self_supply_uniform": "UInt64",
            "deflected_estimated_cost_barter_uniform": "UInt64",
            "deflected_estimated_cost_another_home_uniform": "UInt64",
            "deflected_estimated_cost_social_program_uniform": "UInt64",
            "deflected_estimated_cost_other_uniform": "UInt64",
            "deflected_total_how_much_cost_shoes": "UInt64",
            "deflected_estimated_cost_self_consumption_shoes": "UInt64",
            "deflected_estimated_cost_self_supply_shoes": "UInt64",
            "deflected_estimated_cost_barter_shoes": "UInt64",
            "deflected_estimated_cost_another_home_shoes": "UInt64",
            "deflected_estimated_cost_social_program_shoes": "UInt64",
            "deflected_estimated_cost_other_shoes": "UInt64",
            "deflected_total_how_much_cost_text_books": "UInt64",
            "deflected_estimated_cost_self_consumption_text_books": "UInt64",
            "deflected_estimated_cost_self_supply_text_books": "UInt64",
            "deflected_estimated_cost_barter_text_books": "UInt64",
            "deflected_estimated_cost_another_home_text_books": "UInt64",
            "deflected_estimated_cost_social_program_text_books": "UInt64",
            "deflected_estimated_cost_other_text_books": "UInt64",
            "deflected_total_how_much_cost_school_supplies": "UInt64",
            "deflected_estimated_cost_self_consumption_school_supplies": "UInt64",
            "deflected_estimated_cost_self_supply_school_supplies": "UInt64",
            "deflected_estimated_cost_barter_school_supplies": "UInt64",
            "deflected_estimated_cost_another_home_school_supplies": "UInt64",
            "deflected_estimated_cost_social_program_school_supplies": "UInt64",
            "deflected_estimated_cost_other_school_supplies": "UInt64",
            "deflected_total_how_much_cost_enrollment": "UInt64",
            "deflected_estimated_cost_self_consumption_enrollment": "UInt64",
            "deflected_estimated_cost_self_supply_enrollment": "UInt64",
            "deflected_estimated_cost_barter_enrollment": "UInt64",
            "deflected_estimated_cost_another_home_enrollment": "UInt64",
            "deflected_estimated_cost_social_program_enrollment": "UInt64",
            "deflected_estimated_cost_other_enrollment": "UInt64",
            "deflected_total_how_much_cost_APAFA": "UInt64",
            "deflected_estimated_cost_self_consumption_APAFA": "UInt64",
            "deflected_estimated_cost_self_supply_APAFA": "UInt64",
            "deflected_estimated_cost_barter_APAFA": "UInt64",
            "deflected_estimated_cost_another_home_APAFA": "UInt64",
            "deflected_estimated_cost_social_program_APAFA": "UInt64",
            "deflected_estimated_cost_other_APAFA": "UInt64",
            "deflected_total_how_much_cost_others": "UInt64",
            "deflected_estimated_cost_self_consumption_others": "UInt64",
            "deflected_estimated_cost_self_supply_others": "UInt64",
            "deflected_estimated_cost_barter_others": "UInt64",
            "deflected_estimated_cost_another_home_others": "UInt64",
            "deflected_estimated_cost_social_program_others": "UInt64",
            "deflected_estimated_cost_other_others": "UInt64",
            "deflected_how_much_cost_mensual_teaching_pension": "UInt64",
            "deflected_estimated_cost_total_mensual_teaching_pension": "UInt64",
            "deflected_estimated_cost_self_supply_mensual_teaching_pension": "UInt64",
            "deflected_estimated_cost_barter_mensual_teaching_pension": "UInt64",
            "deflected_estimated_cost_another_home_mensual_teaching_pension": "UInt64",
            "deflected_estimated_cost_social_program_mensual_teaching_pension": "UInt64",
            "deflected_estimated_cost_other_mensual_teaching_pension": "UInt64",
            "deflected_how_much_cost_particular_transportation": "UInt64",
            "deflected_estimated_cost_total_particular_transportation": "UInt64",
            "deflected_estimated_cost_self_supply_particular_transportation": "UInt64",
            "deflected_estimated_cost_barter_particular_transportation": "UInt64",
            "deflected_estimated_cost_another_home_particular_transportation": "UInt64",
            "deflected_estimated_cost_social_program_particular_transportation": "UInt64",
            "deflected_estimated_cost_other_particular_transportation": "UInt64",
            "deflected_how_much_cost_internet": "UInt64",
            "deflected_estimated_total_amount_internet": "UInt64",
            "deflected_estimated_cost_self_supply_internet": "UInt64",
            "deflected_estimated_cost_barter_internet": "UInt64",
            "deflected_estimated_cost_another_home_internet": "UInt64",
            "deflected_estimated_cost_social_program_internet": "UInt64",
            "deflected_estimated_cost_other_internet": "UInt64",
            "factor07": "UInt32",
            "factora07": "UInt32",
            "year": "UInt16",
        }

        transform_step = TransformStep()

        load_step = LoadStep(
            "housing_survey_education", db_connector, if_exists="append", pk=["ubigeo", "year"], dtype=dtype, 
            nullable_list=[
                "childhood_learned_lenguage", "actual_last_academic_degree", "last_year_academic_degree", "last_grade_academic_degree", "study_facility_academic_degree", 
                "has_college_career", "has_college_career_id", "has_college_name", "has_college_id", "has_college_faculty_id", 
                "qa_reading_writing", "test_reading_writing", 
                "12m_alphabetization", "12m_alphabetization_source", "12m_school_uniform", "12m_school_shoes", "12m_school_text_books", 
                "12m_school_school_supplies", "12m_school_enrollment", "12m_school_APAFA", "12m_school_others", "12m_school_laptop_by_child_program", 
                "bought_uniform", "bought_shoes", "bought_text_books", "bought_school_supplies", 
                "bought_enrollment", "bought_APAFA", "bought_others", 
                "self_consumption_uniform", "self_consumption_shoes", "self_consumption_text_books", "self_consumption_school_supplies", 
                "self_consumption_enrollment", "self_consumption_APAFA", "self_consumption_others", 
                "self_supply_uniform", "self_supply_shoes", "self_supply_text_books", "self_supply_school_supplies", 
                "self_supply_enrollment", "self_supply_APAFA", "self_supply_others", 
                "barter_uniform", "barter_shoes", "barter_text_books", "barter_school_supplies", 
                "barter_enrollment", "barter_APAFA", "barter_others", 
                "another_home_uniform", "another_home_shoes", "another_home_text_books", "another_home_school_supplies", 
                "another_home_enrollment", "another_home_APAFA", "another_home_others", 
                "social_program_uniform", "social_program_shoes", "social_program_text_books", "social_program_school_supplies", 
                "social_program_enrollment", "social_program_APAFA", "social_program_others", "social_program_laptop_by_child_program", 
                "other_uniform", "other_shoes", "other_text_books", "other_school_supplies", 
                "other_enrollment", "other_APAFA", "other_others", 
                "how_much_cost_uniform", "how_much_cost_shoes", "how_much_cost_text_books", "how_much_cost_school_supplies", 
                "how_much_cost_enrollment", "how_much_cost_APAFA", "how_much_cost_others", 
                "estimated_cost_bought_uniform", "estimated_cost_self_consumption_uniform", "estimated_cost_self_supply_uniform", "estimated_cost_barter_uniform", 
                "estimated_cost_another_home_uniform", "estimated_cost_social_program_uniform", "estimated_cost_other_uniform", 
                "estimated_cost_bought_shoes", "estimated_cost_self_consumption_shoes", "estimated_cost_self_supply_shoes", "estimated_cost_barter_shoes", 
                "estimated_cost_another_home_shoes", "estimated_cost_social_program_shoes", "estimated_cost_other_shoes", 
                "estimated_cost_bought_text_books", "estimated_cost_self_consumption_text_books", "estimated_cost_self_supply_text_books", "estimated_cost_barter_text_books", 
                "estimated_cost_another_home_text_books", "estimated_cost_social_program_text_books", "estimated_cost_other_text_books", 
                "estimated_cost_bought_school_supplies", "estimated_cost_self_consumption_school_supplies", "estimated_cost_self_supply_school_supplies", "estimated_cost_barter_school_supplies", 
                "estimated_cost_another_home_school_supplies", "estimated_cost_social_program_school_supplies", "estimated_cost_other_school_supplies", 
                "estimated_cost_bought_enrollment", "estimated_cost_self_consumption_enrollment", "estimated_cost_self_supply_enrollment", "estimated_cost_barter_enrollment", 
                "estimated_cost_another_home_enrollment", "estimated_cost_social_program_enrollment", "estimated_cost_other_enrollment", 
                "estimated_cost_bought_APAFA", "estimated_cost_self_consumption_APAFA", "estimated_cost_self_supply_APAFA", "estimated_cost_barter_APAFA", 
                "estimated_cost_another_home_APAFA", "estimated_cost_social_program_APAFA", "estimated_cost_other_APAFA", 
                "estimated_cost_bought_others", "estimated_cost_self_consumption_others", "estimated_cost_self_supply_others", "estimated_cost_barter_others", 
                "estimated_cost_another_home_others", "estimated_cost_social_program_others", "estimated_cost_other_others", 
                "n_times_uniform", "n_times_shoes", "n_times_text_books", "n_times_school_supplies", 
                "n_times_enrollment", "n_times_APAFA", "n_times_others", "total_amount_all_headings_311", "estimated_total_amount_all_headings_311", 
                "last_month_spends_mensual_teaching_pension", "bought_mensual_teaching_pension", "self_supply_mensual_teaching_pension", "barter_mensual_teaching_pension", 
                "another_home_mensual_teaching_pension", "social_program_mensual_teaching_pension", "other_mensual_teaching_pension", "how_much_cost_mensual_teaching_pension", 
                "estimated_cost_total_mensual_teaching_pension", "estimated_cost_self_supply_mensual_teaching_pension", "estimated_cost_barter_mensual_teaching_pension", "estimated_cost_another_home_mensual_teaching_pension", 
                "estimated_cost_social_program_mensual_teaching_pension", "estimated_cost_other_mensual_teaching_pension", "n_times_mensual_teaching_pension", 
                "last_month_spends_particular_transportation", "bought_particular_transportation", "self_supply_particular_transportation", "barter_particular_transportation", 
                "another_home_particular_transportation", "social_program_particular_transportation", "other_particular_transportation", 
                "how_much_cost_particular_transportation", "estimated_cost_total_particular_transportation", "estimated_cost_self_supply_particular_transportation", "estimated_cost_barter_particular_transportation", 
                "estimated_cost_another_home_particular_transportation", "estimated_cost_social_program_particular_transportation", "estimated_cost_other_particular_transportation", "n_times_particular_transportation", 
                "total_amount_all_headings_312", "estimated_total_amount_all_headings_312", "estimated_cost_self_supply_all", "estimated_cost_barter_all", 
                "estimated_cost_another_home_all", "estimated_cost_social_program_all", "estimated_cost_other_all", "main_reason_no_actual_studies", 
                "last_month_use_internet", "use_internet_from_home", "use_internet_from_work", "use_internet_from_education_facility", 
                "use_internet_from_public_cabin", "use_internet_from_another_home", "use_internet_from_other", "use_internet_from_mobile_service", 
                "use_internet_from_computer", "use_internet_from_laptop", "use_internet_from_own_cellphone", "use_internet_from_friends_cellphone", 
                "use_internet_from_works_cellphone", "use_internet_from_tablet", "use_internet_from_other_device", 
                "last_month_internet_highest_used", "use_internet_frecuency", 
                "bought_internet", "self_supply_internet", "barter_internet", "another_home_internet", 
                "social_program_internet", "other_internet", "how_much_cost_internet", 
                "estimated_total_amount_internet", "estimated_cost_self_supply_internet", "estimated_cost_barter_internet", 
                "estimated_cost_another_home_internet", "estimated_cost_social_program_internet", "estimated_cost_other_internet", 
                "use_internet_for_information", "use_internet_for_comunication", "use_internet_for_buying", "use_internet_for_financial_transactions", 
                "use_internet_for_formal_education", "use_internet_for_organizations_transactions", "use_internet_for_entertainment", "use_internet_for_sells", 
                "use_internet_for_other_1", "use_internet_for_other_2", "use_internet_for_other_3", 
                "last_month_use_own_cellphone", 
                "last_month_use_someones_cellphone", "last_month_use_works_cellphone", "last_month_use_own_cellphone_other", "last_month_no_use_cellphone", "last_3m_use_any_typing_item", 
                "deflected_how_much_cost_uniform", "deflected_how_much_cost_shoes", "deflected_how_much_cost_text_books", "deflected_how_much_cost_school_supplies", 
                "deflected_how_much_cost_enrollment", "deflected_how_much_cost_APAFA", "deflected_how_much_cost_others", 
                "deflected_total_how_much_cost_uniform", "deflected_estimated_cost_self_consumption_uniform", "deflected_estimated_cost_self_supply_uniform", "deflected_estimated_cost_barter_uniform", 
                "deflected_estimated_cost_another_home_uniform", "deflected_estimated_cost_social_program_uniform", "deflected_estimated_cost_other_uniform", 
                "deflected_total_how_much_cost_shoes", "deflected_estimated_cost_self_consumption_shoes", "deflected_estimated_cost_self_supply_shoes", "deflected_estimated_cost_barter_shoes", 
                "deflected_estimated_cost_another_home_shoes", "deflected_estimated_cost_social_program_shoes", "deflected_estimated_cost_other_shoes", 
                "deflected_total_how_much_cost_text_books", "deflected_estimated_cost_self_consumption_text_books", "deflected_estimated_cost_self_supply_text_books", "deflected_estimated_cost_barter_text_books", 
                "deflected_estimated_cost_another_home_text_books", "deflected_estimated_cost_social_program_text_books", "deflected_estimated_cost_other_text_books", 
                "deflected_total_how_much_cost_school_supplies", "deflected_estimated_cost_self_consumption_school_supplies", "deflected_estimated_cost_self_supply_school_supplies", "deflected_estimated_cost_barter_school_supplies", 
                "deflected_estimated_cost_another_home_school_supplies", "deflected_estimated_cost_social_program_school_supplies", "deflected_estimated_cost_other_school_supplies", 
                "deflected_total_how_much_cost_enrollment", "deflected_estimated_cost_self_consumption_enrollment", "deflected_estimated_cost_self_supply_enrollment", "deflected_estimated_cost_barter_enrollment", 
                "deflected_estimated_cost_another_home_enrollment", "deflected_estimated_cost_social_program_enrollment", "deflected_estimated_cost_other_enrollment", 
                "deflected_total_how_much_cost_APAFA", "deflected_estimated_cost_self_consumption_APAFA", "deflected_estimated_cost_self_supply_APAFA", "deflected_estimated_cost_barter_APAFA", 
                "deflected_estimated_cost_another_home_APAFA", "deflected_estimated_cost_social_program_APAFA", "deflected_estimated_cost_other_APAFA", 
                "deflected_total_how_much_cost_others", "deflected_estimated_cost_self_consumption_others", "deflected_estimated_cost_self_supply_others", "deflected_estimated_cost_barter_others", 
                "deflected_estimated_cost_another_home_others", "deflected_estimated_cost_social_program_others", "deflected_estimated_cost_other_others", 
                "deflected_how_much_cost_mensual_teaching_pension", "deflected_estimated_cost_total_mensual_teaching_pension", "deflected_estimated_cost_self_supply_mensual_teaching_pension", "deflected_estimated_cost_barter_mensual_teaching_pension", 
                "deflected_estimated_cost_another_home_mensual_teaching_pension", "deflected_estimated_cost_social_program_mensual_teaching_pension", "deflected_estimated_cost_other_mensual_teaching_pension", 
                "deflected_how_much_cost_particular_transportation", "deflected_estimated_cost_total_particular_transportation", "deflected_estimated_cost_self_supply_particular_transportation", "deflected_estimated_cost_barter_particular_transportation", 
                "deflected_estimated_cost_another_home_particular_transportation", "deflected_estimated_cost_social_program_particular_transportation", "deflected_estimated_cost_other_particular_transportation", 
                "deflected_how_much_cost_internet", "deflected_estimated_total_amount_internet", "deflected_estimated_cost_self_supply_internet", "deflected_estimated_cost_barter_internet", 
                "deflected_estimated_cost_another_home_internet", "deflected_estimated_cost_social_program_internet", "deflected_estimated_cost_other_internet", 
                "factor07", "factora07"
              ]
        )

        return [transform_step, load_step]

if __name__ == "__main__":
    
    data = glob.glob('../../data/enh/*.dta')

    pp = ENHPipeline()
    for year in range(2014, 2018 + 1):
    #for year in range(2018, 2018 + 1):
        pp.run({
            'url': '../../data/enh/enaho01a-{}-300.dta'.format(year),
            'year': year
        })